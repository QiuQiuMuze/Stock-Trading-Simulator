# 中国股市模拟交易平台


一个基于 FastAPI + 原生前端的全功能炒股模拟器骨架，实现中国 A 股市场的开盘/收盘节奏、涨跌停限制、随机波动行情以及基础交易功能。每个用户初始拥有 100,000 元人民币，可通过网页界面查看实时行情、单独的个股走势页并执行买卖操作。

## 功能亮点

- ✅ **自动行情引擎**：模拟两段式交易时段（09:30-11:30、13:00-15:00），自动开闭市并限制每日涨跌幅 ±10%。

- ✅ **沪深 300 只龙头股票**：内置沪深 300 成份股完整列表，模拟更贴近真实市场的多股票环境。
- ✅ **实时推送**：通过 WebSocket 推送最新行情及市场状态，前端即时刷新表格和价格颜色（红涨绿跌）。
- ✅ **交互式走势图**：使用 Chart.js 绘制分时价格曲线，在搜索后进入个股详情页查看独立图表。
- ✅ **模拟账户系统**：注册/登录后即拥有初始 10 万元资金，支持买入/卖出、持仓与交易历史展示，并自动持久化到后端数据库。
- ✅ **账号体系**：提供注册、登录、退出流程，用户名+密码即可使用，无需验证码或复杂校验。
- ✅ **单点登录与搜索**：同一账号在其他页面登录会自动挤掉旧会话，单个浏览器标签页的会话相互独立，并支持根据代码/名称实时搜索筛选股票列表。
- ✅ **独立登录/注册页**：登录、注册与行情页面完全分离，登录后方可进入市场，未登录时不会暴露行情数据。


## 快速开始

1. **安装依赖**

   ```bash
   python -m venv .venv
   source .venv/bin/activate  # Windows 使用 .venv\Scripts\activate
   pip install -r requirements.txt
   ```

2. **运行服务**

   ```bash
   uvicorn app.main:app --reload
   ```


3. 浏览器访问 [http://localhost:8000](http://localhost:8000)，在独立页面完成注册或登录后即可进入行情列表和个股详情。

### 账号与数据存储

- 用户凭用户名+密码注册后，系统会在 `data/simulator.db`（SQLite）中持久化账户资金、持仓和交易记录。
- 登录成功后会颁发一次性会话令牌，保存在当前浏览器标签页的 `sessionStorage` 中；同一账号在其他终端或标签页登录时会自动失效旧令牌。
- 每个标签页独立维护会话，方便在同一台设备上同时操作不同账号。
- 退出登录将清除本地缓存但不影响数据库中的历史交易数据。


## 可选配置

通过环境变量可调节模拟节奏：

| 变量名 | 说明 | 默认值 |
| ------ | ---- | ------ |
| `SIMULATION_SPEED` | 行情刷新速度倍数，>1 表示更快推送 | `1.0` |
| `MARKET_TICK_SECONDS` | 行情引擎基础刷新间隔（秒） | `2.0` |
| `FORCE_MARKET_OPEN` | 设为 `1` 时强制保持开市，便于演示 | `0` |

## 项目结构

```
app/
  main.py          # FastAPI 入口，API 与 WebSocket
  market.py        # 行情与账户模拟核心逻辑
  models.py        # Pydantic 数据模型
static/
  css/style.css    # 页面样式（红涨绿跌、暗色主题）
  js/app.js        # 前端逻辑：行情订阅、表格渲染、交易提交
templates/

  login.html        # 登录页
  register.html     # 注册页
  app.html          # 行情与交易面板
  stock_detail.html # 个股行情详情

```

## 后续扩展建议

- 增加 K 线、成交量等更多图表类型

- 扩展行情历史存储或接入真实数据源
- 增加角色/权限控制、风控指标

- 完善委托撮合与撮合成交回报

> ⚠️ 本项目仅用于教学与演示目的，所有数据均为随机模拟，不构成任何投资建议。
